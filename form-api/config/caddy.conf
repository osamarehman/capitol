# Caddy configuration for forms.improveitmd.com
# Add this block to /etc/caddy/Caddyfile

forms.improveitmd.com {
    # Use Cloudflare Origin wildcard certificate
    tls /etc/caddy/ssl/improveitmd.com.crt /etc/caddy/ssl/improveitmd.com.key

    # Request body size for form submissions (10MB)
    request_body {
        max_size 10MB
    }

    # Reverse proxy to Flask application
    reverse_proxy localhost:5000 {
        # Standard timeouts
        transport http {
            read_timeout 60s
            write_timeout 60s
        }

        # Pass through important headers
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-Host {host}
    }

    # Enable logging
    log {
        output file /var/log/caddy/forms-access.log
        format json
    }

    # Security headers
    header {
        # Enable HSTS
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        # Prevent clickjacking
        X-Frame-Options "SAMEORIGIN"
        # Prevent MIME sniffing
        X-Content-Type-Options "nosniff"
        # Enable XSS protection
        X-XSS-Protection "1; mode=block"
        # Referrer policy
        Referrer-Policy "strict-origin-when-cross-origin"
    }

    # Enable gzip compression
    encode gzip
}
